<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="slider-carousel">
  <template>
  	<style>
      :host {
        display: block;
        position: relative;
        overflow: hidden;
        width: 100%;
        contain: content;
      }

      :host::after {
        display: block;
        content: '';
        padding-top: 75%; /* 4:3 = height is 75% of width */
      }

      ::slotted([selected]){
        width: 100%;
        height: 100%;
        position: absolute;
      }

      ::slotted(:not([selected])) {
        display: none;
      }

      button {
        position: absolute;
        top: calc(50% - 20px);
        padding: 0;
        line-height: 40px;
        border: none;
        background: none;
        color: #DDD;
        font-size: 40px;
        font-weight: bold;
        opacity: 0.7;
        cursor: pointer;
      }

      button:hover,
      button:focus {
        opacity: 1;
      }

      #prevBtn {
        left: 12px;
      }

      #nextBtn {
        right: 12px;
      }

      button[disabled] {
        opacity: 0.4;
        cursor: auto;
        pointer-events: none;
      }
      
    </style>
    <slot></slot> 
    <button id="prevBtn">&#x276E;</button>
    <button id="nextBtn">&#x276F;</button>
  </template>
  <script>
  class SliderCarousel extends Polymer.Element {
  	static get is() {
      return 'slider-carousel';
    }
    static get properties() {
    	return {
    		selected: {
    			type: Number,
    			value: 0,
    			reflectedToAttribute: true,
    			observer: 'changeSelected'
    		}
    	}
    }

    constructor() {
    	super();    	
    }

    ready(){
    	super.ready();  
    	this.btnPrev = this.shadowRoot.querySelector('#prevBtn');
        this.btnNext = this.shadowRoot.querySelector('#nextBtn');
    }

    connectedCallback() {
    	super.connectedCallback();
        this.images = Array.prototype.slice.call(this.children);
        this.btnPrev.addEventListener('click', this.prev.bind(this));
        this.btnNext.addEventListener('click', this.next.bind(this));
    }
    disconnectedCallback() {
    	super.disconnectedCallback();
		this.btnPrev.removeEventListener('click', this.prev.bind(this));
		this.btnNext.removeEventListener('click', this.next.bind(this));
    }

    changeSelected(newValue, oldValue) {
    	if(oldValue) {
            this.children[oldValue].removeAttribute('selected');
          }
          this.children[newValue].setAttribute('selected', '');
          //this.btnNext.disabled = !(this.selected < this.children.length - 1);
          //this.btnPrev.disabled = !(this.selected > 0);

          let selected = this.querySelector('[selected]')

          this._loadImage(selected);
          this._loadImage(selected.previousElementSibling);
          this._loadImage(selected.nextElementSibling);
    }

    next() {
        this.selected++;
      }

      prev() {
        this.selected--;
      }

      show(idx) {
        if (idx >= 0 && idx < this.children.length){
          this.selected = idx;
        }
      }

      _loadImage(img) {
        if (img && !img.src) {
          img.src = img.getAttribute('data-src');
        }
      }
    


  }
  customElements.define(SliderCarousel.is, SliderCarousel);
  </script>
</dom-module>